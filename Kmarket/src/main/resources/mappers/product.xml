<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.kmarket.dao.ProductDao">
	

	<select id="selectProduct" resultType="kr.co.kmarket.vo.ProductVo">
		SELECT *, FLOOR(`price` * (1 - `discount`/100)) AS `salePrice` FROM `km_product` 
		WHERE `pid`=#{pid};
	</select>
	
	
	<select id="selectProducts" resultType="kr.co.kmarket.vo.ProductVo">
		SELECT *, FLOOR(`price` * (1 - `discount`/100)) AS `salePrice` FROM `km_product` 
		WHERE `cate1`=#{cate1} AND `cate2`=#{cate2}
		<if test="order == 1">ORDER BY `sold` DESC</if>
		<if test="order == 2">ORDER BY `salePrice` ASC</if>
		<if test="order == 3">ORDER BY `salePrice` DESC</if>
		<if test="order == 4">ORDER BY `score` DESC</if>
		<if test="order == 5">ORDER BY `review` DESC</if>
		<if test="order == 6">ORDER BY `rdate` DESC</if>
		LIMIT #{start}, 10;
	</select>
	
	<select id="selectCateTitles" resultType="kr.co.kmarket.vo.CategoriesVo">
		SELECT c2.cate1, c2.cate2, c1.title AS tit1, c2.title AS tit2 
		FROM `km_product_cate1` AS c1
		JOIN `km_product_cate2` AS c2
		ON c1.cate1 = c2.cate1
		WHERE c2.cate1=#{cate1} AND c2.cate2=#{cate2};
	</select>


	<insert id="insertCart">
		INSERT INTO `km_product_cart` SET
		`uid`=#{uid},
		`pid`=#{pid},
		`count`=#{count},
		`price`=#{price},
		`discount`=#{discount},
		`point`=#{point},
		`delivery`=#{delivery},
		`total`=#{total},
		`rdate`=NOW();
	</insert>
	
	<select id="selectCarts" resultType="kr.co.kmarket.vo.CartVo">
		SELECT a.*, b.cate1, b.cate2, b.name, b.desc, b.thumb1
		FROM `km_product_cart` AS a
		JOIN `km_product` AS b
		ON a.pid = b.pid
		WHERE `uid`=#{uid};
	</select>
	



</mapper>